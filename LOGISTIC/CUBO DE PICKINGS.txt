SELECT TB1.COD_PEDIDO AS COD_PEDIDO,
	   LIKP.VBELN AS COD_ENTREGA,
	   LIKP.ERDAT AS FECHA_ENTREGA,
	   LIKP.ERZET AS HORA_ENTREGA,
	   TB1.FECHA_PEDIDO AS FECHA_PEDIDO,
	   TB1.HORA_PEDIDO AS HORA_PEDIDO,
	   LIKP.VSTEL AS COD_PUESTO_EXPEDICION,
	   LIKP.LFART AS COD_TIPO_DOCUMENTO,
	   LIKP.ROUTE AS COD_RUTA,
	   LIKP.KUNNR AS COD_CLIENTE,
	   VBPA.KUNNR AS COD_VENDEDOR,
	   VBPA2.KUNNR AS COD_TRANSPORTISTA,
	  
	   TB1.NUM_SKU AS NUM_SKU,
	   TB1.CANTIDAD AS CANTIDAD
FROM SAPABAP1.LIKP
LEFT JOIN SAPABAP1.VBPA  ON VBPA.VBELN = LIKP.VBELN --- CODIGOS DE AGENTE ---
						  AND VBPA.PARVW = 'VD'
LEFT JOIN SAPABAP1.VBPA VBPA2 ON VBPA2.VBELN = LIKP.VBELN 
						  AND VBPA2.PARVW = 'SP'
LEFT JOIN ( SELECT VBFA.VBELV AS COD_PEDIDO,
	   VBFA.VBELN AS COD_ENTREGA,
	   VBAK.ERDAT AS FECHA_PEDIDO,
	   VBAK.ERZET AS HORA_PEDIDO,
	   VBAK.HITYP_PR AS CLASIFICACION,
	   TB2.NUM_SKU AS NUM_SKU,
	   SUM(RFMNG) AS CANTIDAD
FROM SAPABAP1.VBFA
INNER JOIN SAPABAP1.VBAK ON  VBFA.VBELV = VBAK.VBELN  
LEFT JOIN ( SELECT  VBELN AS COD_PEDIDO,
			COUNT(DISTINCT MATNR) AS NUM_SKU
	FROM SAPABAP1.VBAP  
	GROUP BY VBELN  ) TB2 ON VBFA.VBELV =  TB2.COD_PEDIDO
GROUP BY VBFA.VBELV,
	   VBFA.VBELN,
	   VBAK.ERDAT,
	   VBAK.ERZET,
	   VBAK.HITYP_PR,
	   NUM_SKU
	   ) TB1 ON TB1.COD_ENTREGA = LIKP.VBELN
WHERE LIKP.VBELN IN ('5700728156')